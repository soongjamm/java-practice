# 만들면서 배우는 클린 아키텍처

## 책을 읽고 떠오르는 질문과 생각을 정리해보자.

### 레이어드 어키텍처란 무엇인가?
- [웹 -> 도메인 -> 영속성] 계층으로 이루어진 아키텍처이다.
- 도메인 로직에 영향을 주지 않고 웹과 영속성 기술을 변경하거나 기능을 추가할 수 있는 아키텍처이다.
  - 새로운 요구사항과 외부 요인에 빠르게 적응가능하다.
- 도메인 레이어는 흔히 사용하는 `Service`를 포함한다. (보통 Service가 영속성에 의존한다.)

**문제점**
- 계층이 흐르는 방향을 보면 자연스럽게 도메인이 영속성(데이터베이스)에 의존한다.
  - 데이터베이스에 의존적인 개발을 유도한다.
- 도메인(Service)에서 트랜잭션, 캐시 같은 도메인과 관련없는 로직을 처리할 가능성이 크다.
  - 보통 JPA같은 ORM을 사용하게 되는데, 엔티티를 영속성 계층에 두고 그 엔티티를 도메인 계층에서 사용하면  
    자연스럽게 도메인에서 영속성과 관련된 코드를 처리하게 된다는게 이유
> **왜 문제인가?**  
애플리케이션의 목적은 비즈니스의 룰이나 정책을 반영한 모델을 만들어 사용자에게 제공하는 것이다.  
즉, 행동이 중요한데. 데이터베이스에 의존적이라는 것은 '상태'에 좀 더 집중한다.  
**_그리고 도메인에 영속성 코드가 녹아들어서 강하게 결합되면 각각 변경이 어려워진다._**

- 레이어드 아키텍처는 강제하는 규칙이 많지 않다. 
  - 간단한 수정이면 웹 계층에서 도메인을 건너뛰고 영속성 계층으로 갈 수도 있다.
  - 도메인 로직이 여기저기 흩어지기 시작한다.
    - **테스트가 어려워진다.**
  - **유스케이스를 알기가 어려워진다.** with 아주 넓어진 서비스
    - SRP를 적용하자. 서비스를 유스케이스별로 나눈다.

  
- 서비스가 넓어지면 동시에 여러기능을 여러 개발자가 개발할 때, merge conflict 가능성이 높다.

### 헥사고날 아키텍처란 무엇인가? (포트와 어댑터)
- 도메인과 상호작용 하기 위해선 `포트`라고 불리는 인터페이스를 거치게 된다.
  - 각 포트를 구현한 구현체는 `어댑터` 라고 불리며, 육각형 모양의 바깥에 위치한다.
  - 도메인 영역은 육각형 안쪽에 위치한다. 
    - 도메인을 HTTP나 데이터베이스등 외부 기술로부터 독립적이게 만들어준다.
  - 의존성이 도메인 방향을 향해 흐른다.
- 포트가 있어서 의존성 역전이 발생하고, 계층간 결합도가 낮아지게 된다. **(DIP)**
  - 포트가 없었다면, 웹 계층이 유스케이스 코드를 의존하는 형태일 것이다.  
    유스케이스 코드의 변경이 웹 계층에도 영향을 미치게 된다.   
    새로운 유스케이스 구현체로 교체하고 싶다면 웹 계층 코드를 고쳐야한다. _(OCP 위반)_
  - 그러나 포트가 있기때문에, 웹이 포트에 의존하는 한 구현체는 얼마든지 바껴도 된다. **(OCP)**

### 레이어드 아키텍처와 헥사고날 아키텍처 공통점과 차이점은 무엇인가?
공통점
- 두 아키텍처 모두 잘 사용한다면 도메인을 외부 요인에 영향받지 않도록 잘 보호할 수 있다.  
  기능을 추가하는데도 자유롭다.

차이점
- 레이어드 아키텍처는 계층 흐름상 도메인이 영속성에 의존적이다. 
- 그래서 오는 단점들이 있다.

### 클래스를 분리하면 단일 클래스보다 좋은 점이 무엇인가?
- 클래스를 분리하면 단일 책임 원칙을 만족하게 될 가능성이 높다.
- 외부의 변경에 영향을 덜 받게 된다.
  - 그렇지 않은 경우는 여러 컴포넌로 부터 변경의 영향을 받게 된다.
- 특정한 기능을 하는 컴포넌트를 찾기가 더 쉬워진다. (파악에 용이하다.)

### 포트(간접계층)을 두면 어떤 특징이 생기는가? 왜 좋은가?
- 의존성을 역전시킬 수 있다. 
- 클라이언트에 영향을 주지 않고 구현체를 유연하게 변경할 수 있게 된다.
- OCP를 만족하게 된다.

### 왜 응집도가 높고 결합도가 낮아야 좋은가?
- 모듈 단위로 봤을때, 응집도가 높으면 코드를 보지 않아도 구조나 책임등을 파악하기 용이하다.
  - 반대로 말하면, 응집도가 떨어지면 로직이 여기저기 흩어져서 파악하기가 어렵고, 변경도 어려워진다.
- 결합도가 높다는건 컴포넌트간의 의존성이 높다고 할 수 있다.
  - 결합된 만큼, 그 대상들의 변경에 영향을 받게된다. -> SRP를 위반하게 된다.

### 왜 의존성은 안쪽(도메인) 방향으로 흘러야 하는가?
- 도메인이란, 비즈니스의 규칙이나 정책 등을 반영한 모델을 만들어 사용자에게 제공하는 것이다.
- 변경이 잦을 수 있으니, 기능 추가가 용이하여야 한다.
- 외부 요인으로부터 독립적이어야 한다. 외부 요소는 비즈니스 규칙과 무관하게 변할 수 있기 때문이다.
- **도메인을 안쪽에 둔다는건 도메인이 어디에도 의존하지 않는다는 뜻이다.**